{
    "contents" : "aucJM.JMbayes <- function (object, newdata, Tstart, Thoriz = NULL, Dt = NULL, idVar = \"id\", \n        simulate = FALSE, M = 100, ...) {\n    if (!inherits(object, \"JMbayes\"))\n        stop(\"Use only with 'JMbayes' objects.\\n\")\n    if (!is.data.frame(newdata) || nrow(newdata) == 0)\n        stop(\"'newdata' must be a data.frame with more than one rows.\\n\")\n    if (is.null(newdata[[idVar]]))\n        stop(\"'idVar' not in 'newdata'.\\n\")\n    if (is.null(Thoriz) && is.null(Dt))\n        stop(\"either 'Thoriz' or 'Dt' must be non null.\\n\")\n    if (is.null(Thoriz))\n        Thoriz <- Tstart + Dt\n    id <- newdata[[idVar]]\n    id <- match(id, unique(id))\n    TermsT <- object$Terms$termsT\n    SurvT <- model.response(model.frame(TermsT, newdata)) \n    is_counting <- attr(SurvT, \"type\") == \"counting\"\n    Time <- if (is_counting) {\n        ave(SurvT[, 2], id, FUN = function (x) tail(x, 1))\n    } else {\n        SurvT[, 1]\n    }\n    timeVar <- object$timeVar\n    ordTime <- order(Time)\n    newdata2 <- newdata[ordTime, ]\n    newdata2 <- newdata2[Time[ordTime] > Tstart, ]\n    newdata2 <- newdata2[newdata2[[timeVar]] <= Tstart, ]\n    pi.u.t <- if (is_counting) {\n        survfitJM(object, newdata = newdata2, idVar = idVar, survTimes = Thoriz, \n                  simulate = simulate, M = M, LeftTrunc_var = all.vars(TermsT)[1L])\n    } else {\n        survfitJM(object, newdata = newdata2, idVar = idVar, survTimes = Thoriz, \n                  simulate = simulate, M = M)\n    }\n    pi.u.t <- sapply(pi.u.t$summaries, \"[\", 1, 2)\n    # find comparable subjects\n    id <- newdata2[[idVar]]\n    SurvT <- model.response(model.frame(TermsT, newdata2)) \n    if (is_counting) {\n        f <- factor(id, levels = unique(id))\n        Time <- tapply(SurvT[, 2], f, tail, 1)\n        event <- tapply(SurvT[, 3], f, tail, 1)\n    } else{\n        Time <- SurvT[!duplicated(id), 1]\n        event <- SurvT[!duplicated(id), 2]\n    }\n    names(Time) <- names(event) <- as.character(unique(id))\n    if (!all(names(pi.u.t) == names(Time)))\n        stop(\"mismatch between 'Time' variable names and survival probabilities names.\")\n    auc <- if (length(Time) > 1) {\n        pairs <- combn(as.character(unique(id)), 2)\n        Ti <- Time[pairs[1, ]]\n        Tj <- Time[pairs[2, ]]\n        di <- event[pairs[1, ]]\n        dj <- event[pairs[2, ]]\n        pi.u.t.i <- pi.u.t[pairs[1, ]]\n        pi.u.t.j <- pi.u.t[pairs[2, ]]\n        ind1 <- (Ti <= Thoriz & di == 1) & Tj > Thoriz\n        ind2 <- (Ti <  Thoriz & di == 1) & (Tj == Thoriz & dj == 0)\n        ind3 <- (Ti <= Thoriz & di == 0) & Tj > Thoriz\n        ind <- ind1 | ind2 | ind3\n        if (any(ind3)) {\n            nams <- unique(names(ind3[ind3]))\n            pi2 <- if (is_counting) {\n                survfitJM(object, newdata = newdata2[id %in% nams, ], idVar = idVar, \n                             last.time = Time[nams], survTimes = Thoriz, \n                             simulate = simulate, M = M, LeftTrunc_var = all.vars(TermsT)[1L])\n            } else {\n                survfitJM(object, newdata = newdata2[id %in% nams, ], idVar = idVar, \n                          last.time = Time[nams], survTimes = Thoriz, \n                          simulate = simulate, M = M)\n            }\n            pi2 <- 1 - sapply(pi2$summaries, \"[\", 1, 2)\n            nams2 <- names(ind3[ind3])\n            ind[ind3] <- ind[ind3] * pi2[nams2]\n        }\n        sum((pi.u.t.i < pi.u.t.j) * ind, na.rm = TRUE) / sum(ind, na.rm = TRUE)\n    } else {\n        NA\n    }\n    out <- list(auc = auc, Tstart = Tstart, Thoriz = Thoriz, nr = length(unique(id)), \n                classObject = class(object), nameObject = deparse(substitute(object)))\n    class(out) <- \"aucJM\"\n    out\n}\n",
    "created" : 1458043958196.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1797459596",
    "id" : "907E116",
    "lastKnownWriteTime" : 1458045772,
    "path" : "C:/Users/Dimitris/Documents/PackagesGitHub/JMbayes/R/aucJM.JMbayes.R",
    "project_path" : "R/aucJM.JMbayes.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}